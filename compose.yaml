services:
  backend-1-service-registry:
    build: backend/1-service-registry
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-1-service-registry:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/1-service-registry
    environment:
      PORT: 8761
      HOSTNAME: backend-1-service-registry
    ports:
    - 8761:8761

  backend-2-api-gateway:
    build: backend/2-api-gateway
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-2-api-gateway:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/2-api-gateway
    environment:
      PORT: 8000
      SERVICE_REGISTRY_URL: http://backend-1-service-registry:8761/eureka/
    depends_on:
    - backend-1-service-registry
    ports:
    - 8000:8000
    restart: always

  backend-3-auth:
    build: backend/3-auth
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-3-auth:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/3-auth
    environment:
      PORT: 8002
      EUREKA_HOST_NAME: backend-1-service-registry
      EUREKA_PORT: 8761
      DJANGO_SUPERUSER_USERNAME: admin
      DJANGO_SUPERUSER_EMAIL: admin@mail.com
      DJANGO_SUPERUSER_PASSWORD: 1q2w3e4R!
    depends_on:
    - backend-1-service-registry
    restart: always

  backend-4-e3selector-web:
    build: backend/4-e3selector
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-4-e3selector:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/4-e3selector
    environment:
      PORT: 8004
      EUREKA_HOST_NAME: backend-1-service-registry
      EUREKA_PORT: 8761
      REDIS_HOST: backend-4-e3selector-redis
    depends_on:
    - backend-1-service-registry
    - backend-4-e3selector-redis
    restart: always

  backend-4-e3selector-worker:
    build: backend/4-e3selector
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-4-e3selector:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/4-e3selector
    command: bin/worker
    environment:
      REDIS_HOST: backend-4-e3selector-redis
    depends_on:
    - backend-4-e3selector-redis
    restart: always

  backend-4-e3selector-redis:
    image: redis:7.2.1
    restart: always

  backend-5-studycompass-web:
    build: backend/5-studycompass
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-5-studycompass:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/5-studycompass
    environment:
      PORT: 8005
      EUREKA_HOST_NAME: backend-1-service-registry
      EUREKA_PORT: 8761
      REDIS_HOST: backend-5-studycompass-redis
      NEO4J_HOSTNAME: backend-5-studycompass-neo4j
      NEO4J_PASSWORD: password
    depends_on:
    - backend-1-service-registry
    - backend-5-studycompass-redis
    - backend-5-studycompass-neo4j
    restart: always

  backend-5-studycompass-worker:
    build: backend/5-studycompass
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-backend-5-studycompass:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: backend/5-studycompass
    command: bin/worker
    environment:
      REDIS_HOST: backend-5-studycompass-redis
      NEO4J_HOSTNAME: backend-5-studycompass-neo4j
      NEO4J_PASSWORD: password
    depends_on:
    - backend-5-studycompass-redis
    - backend-5-studycompass-neo4j
    restart: always

  backend-5-studycompass-redis:
    image: redis:7.2.1
    restart: always

  backend-5-studycompass-neo4j:
    image: neo4j:5.12.0
    environment:
      NEO4J_AUTH: neo4j/password
    volumes:
    - backend-5-studycompass-neo4j-data:/data
    restart: always

  frontend:
    build: frontend
    image: ${IMAGE_NAME_PREFIX:-socialcomputing/}elas-official-frontend:${IMAGE_TAG:-latest}
    develop:
      watch:
      - action: rebuild
        path: frontend
    environment:
      BASE_URL: ""
    depends_on:
    - backend-2-api-gateway
    ports:
    - 8080:8080

volumes:
  backend-5-studycompass-neo4j-data:
